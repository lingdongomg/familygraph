## 新增需求

### 需求: 亲属称谓查找表
系统应维护一张映射表（FORMAL_TITLE_MAP），覆盖五代中国亲属称谓: 从高祖辈到玄孙辈，包括姻亲和旁系亲属。映射表使用 "RELATION1>RELATION2>...|GENDER" 格式的关系路径键，映射到标准中文亲属称谓。

#### 场景: 直系父辈称谓
- **当** 从我到目标的路径为 "FATHER"，且目标性别为男
- **则** 正式称谓为 "父亲"

#### 场景: 叔父（父亲的弟弟）
- **当** 路径为 "FATHER>YOUNGER_BROTHER"，且目标性别为男
- **则** 正式称谓为 "叔父"

#### 场景: 外祖母
- **当** 路径为 "MOTHER>MOTHER"，且目标性别为女
- **则** 正式称谓为 "外祖母"

#### 场景: 堂兄弟
- **当** 路径为 "FATHER>OLDER_BROTHER>SON"，且目标性别为男
- **则** 正式称谓为 "堂兄/堂弟"

#### 场景: 姻亲称谓（妻子的父亲）
- **当** 路径为 "WIFE>FATHER"，且目标性别为男
- **则** 正式称谓为 "岳父"

#### 场景: 高祖父（第五代直系）
- **当** 路径为 "FATHER>FATHER>FATHER>FATHER"，且目标性别为男
- **则** 正式称谓为 "高祖父"

#### 场景: 高祖母（第五代直系）
- **当** 路径为 "FATHER>FATHER>FATHER>MOTHER"，且目标性别为女
- **则** 正式称谓为 "高祖母"

#### 场景: 玄孙（第五代直系后裔）
- **当** 路径为 "SON>SON>SON>SON"，且目标性别为男
- **则** 正式称谓为 "玄孙"

#### 场景: 玄孙女（第五代直系后裔）
- **当** 路径为 "SON>SON>SON>DAUGHTER"，且目标性别为女
- **则** 正式称谓为 "玄孙女"

#### 场景: 外高祖父（母系第五代）
- **当** 路径为 "MOTHER>FATHER>FATHER>FATHER"，且目标性别为男
- **则** 正式称谓为 "外高祖父"

#### 场景: 五代旁系（族兄弟）
- **当** 路径为 "FATHER>FATHER>OLDER_BROTHER>SON>SON"，且目标性别为男
- **则** 正式称谓为 "族兄/族弟"

### 需求: BFS 亲属路径计算
系统应使用 BFS 在关系图上计算任意两个 Person 之间的最短关系路径，最大深度为 5 条边（五代）。

#### 场景: 计算有关联的两人之间的称谓
- **当** 用户请求从 Person A 到 Person B 的正式称谓
- **则** 系统通过 BFS 找到最短路径（最大深度 5）
- **且** 构建路径键并查询 FORMAL_TITLE_MAP
- **且** 返回正式中文亲属称谓

#### 场景: 五代内无路径
- **当** 两人之间不存在长度 <= 5 的路径
- **则** 系统返回通用称谓 "亲属"

#### 场景: 第五代路径性能
- **当** 家庭图有 200 个节点，BFS 搜索深度为 5
- **则** BFS 完成时间应在 100ms 以内（对于稀疏家庭关系图，实际搜索空间远小于理论上限）

### 需求: 自定义昵称和备注
系统应允许家庭成员为任何 Person 设置自定义昵称（custom_title）和个人备注，连同手机号、微信号、城市、职业、出生日期等私人覆盖字段，按用户存储在 `person_notes` 集合中。自定义昵称在展示时优先于计算的正式称谓。

#### 场景: 设置自定义昵称
- **当** 用户为某 Person 设置自定义称呼 "二舅妈"
- **则** 系统创建或更新一条 `person_notes` 记录
- **且** 后续图谱和详情视图显示 "二舅妈" 而非计算的正式称谓

#### 场景: 未设置自定义昵称
- **当** 用户未为某 Person 设置自定义昵称
- **则** 系统显示计算的正式亲属称谓

#### 场景: 记录私人覆盖字段
- **当** 用户为某 Person 记录手机号、微信号、城市等信息
- **则** 系统将这些信息存储到该用户的 `person_notes` 记录中（phone 和 wechat_id 做 AES 加密）
- **且** 其他用户无法看到此信息
