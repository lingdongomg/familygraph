## 新增需求

### 需求: 编辑历史记录
系统应在 `edit_history` 集合中记录对 Person 记录共享字段（姓名、性别、出生年份、是否已故、头像）的所有创建、更新和删除操作。更新和删除记录应包含 `snapshot_before`（修改前的共享字段文档状态）。私人覆盖字段（手机号、城市等存储在 person_notes 中的数据）的变更不记入编辑历史。

#### 场景: 记录成员共享信息更新
- **当** 用户将某 Person 的姓名从 "王大明" 改为 "王大民"
- **则** 系统创建一条 `edit_history` 记录，action 为 "update"，field_changes 显示新旧值，snapshot_before 包含更新前的共享字段文档

#### 场景: 记录成员删除
- **当** Owner 删除一个成员
- **则** 系统创建一条 `edit_history` 记录，action 为 "delete"，snapshot_before 包含删除前的共享字段

#### 场景: 私人覆盖字段变更不记录
- **当** 用户通过 note/upsert 修改自己对某 Person 的手机号备注或城市备注
- **则** 系统不创建 edit_history 记录（私人覆盖字段属于用户个人数据）

### 需求: 查看编辑历史
系统应仅允许 Owner 查看家庭的编辑历史，按创建时间倒序排列。

#### 场景: Owner 查看历史
- **当** Owner 打开编辑历史页面
- **则** 系统返回历史记录，显示谁在何时修改了哪个成员的哪些共享字段

#### 场景: 非 Owner 尝试查看历史
- **当** Member 或 Restricted 用户尝试查看编辑历史
- **则** 系统拒绝请求并返回权限错误

### 需求: 回滚到历史状态
系统应仅允许 Owner 使用编辑历史记录中的 `snapshot_before` 将成员的共享字段回滚到之前的状态。回滚操作应创建一条新的 action 为 "rollback" 的编辑历史记录。回滚仅影响共享字段，不影响任何用户的私人覆盖字段（person_notes）。

#### 场景: Owner 执行回滚
- **当** Owner 选择一条历史记录并点击 "回档到此状态"
- **则** 系统用 `snapshot_before` 覆盖该成员当前的共享字段数据
- **且** 创建一条新的编辑历史记录，action 为 "rollback"
- **且** 将原历史记录标记为 `is_rolled_back = true`
- **且** 不影响任何用户对该成员的 person_notes 数据

### 需求: 历史保留限制
系统应最多保留编辑历史记录 90 天或每家庭 500 条，以先达到的限制为准。过期记录由每日定时任务清理。

#### 场景: 历史超过 90 天
- **当** 每日清理任务运行
- **则** 创建时间超过 90 天的编辑历史记录被删除
