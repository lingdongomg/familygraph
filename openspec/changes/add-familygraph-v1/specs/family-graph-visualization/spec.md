## 新增需求

### 需求: 力导向图布局
系统应使用自定义力导向布局算法在 Canvas 2D 上计算家庭关系图的节点位置。算法应在所有节点对之间施加斥力，沿关系边施加引力，并应用辈分层约束（Y 轴）和配偶对齐。

#### 场景: 辈分分层布局
- **当** 图中包含跨多代的成员
- **则** 同辈分的成员在同一 Y 层级定位
- **且** 长辈在晚辈上方
- **且** 配偶对水平对齐

#### 场景: 布局收敛
- **当** 模拟运行最多 100 次迭代
- **则** 节点位置在画布边界内稳定（40px 边距）
- **且** 节点之间不显著重叠

### 需求: Canvas 图谱渲染
系统应在微信小程序 Canvas 2D 元素上渲染家庭图谱，支持高 DPI。节点显示圆形头像（无头像时回退为姓名首字），背景色按性别区分。不同关系类型使用不同边样式: 配偶为红色实线、亲子为蓝色实线、兄弟姐妹为灰色虚线。

#### 场景: 渲染有头像的节点
- **当** 某 Person 有已加载的头像图片
- **则** 节点显示圆形裁剪的头像，带彩色边框（当前用户红色、选中蓝色、其他灰色）

#### 场景: 渲染无头像的节点
- **当** 某 Person 没有头像
- **则** 节点在按性别着色的背景上显示姓名首字（男性蓝色调、女性粉色调）

#### 场景: 渲染关系边
- **当** 两人为配偶关系
- **则** 边渲染为红色实线（宽度 2）
- **当** 两人为亲子关系
- **则** 边渲染为蓝色实线（宽度 1.5）

### 需求: 图谱触摸交互
系统应在图谱画布上支持双指缩放、拖拽平移和点击选择交互。

#### 场景: 点击节点
- **当** 用户点击图谱中的某个人物节点
- **则** 系统高亮该节点并跳转到或显示该人物的详情视图

#### 场景: 拖拽平移
- **当** 用户在画布空白区域拖拽
- **则** 图谱视口按拖拽偏移量平移

#### 场景: 双指缩放
- **当** 用户执行双指捏合手势
- **则** 图谱以捏合中心为原点等比缩放

### 需求: 图谱节点标签
系统应在每个节点下方显示标签，展示该 Person 的显示称谓。当前用户的节点标签显示 "我"。其他节点优先显示自定义昵称，其次为计算的亲属称谓，最后为姓名。

#### 场景: 当前用户节点标签
- **当** 图谱渲染当前用户自己的节点
- **则** 标签显示 "我"

#### 场景: 有自定义昵称的节点
- **当** 当前用户为某 Person 设置了自定义昵称
- **则** 标签显示自定义昵称

#### 场景: 仅有计算称谓的节点
- **当** 未设置自定义昵称但可以计算亲属称谓
- **则** 标签显示正式亲属称谓
