## 新增需求

### 需求: 照片上传与压缩
系统应允许 Owner、Member 和 Restricted（仅限自己的照片）用户上传照片。照片应在客户端压缩至最长边 1080px、80% JPEG 质量。同时生成 300px、60% 质量的缩略图。

#### 场景: 在配额内上传照片
- **当** 用户上传照片且家庭存储配额充足
- **则** 系统将图片压缩至 1080p，生成缩略图
- **且** 将原图和缩略图上传至云存储
- **且** 创建一条 `photos` 记录，包含文件引用
- **且** 递增家庭的 `storage_used_bytes`

#### 场景: 上传超出存储配额
- **当** 用户上传照片但家庭已用存储加上文件大小超出限制
- **则** 系统拒绝上传并提示当前用量和最大容量

#### 场景: Restricted 用户上传范围限制
- **当** Restricted 用户上传照片
- **则** 照片只能关联到该 Restricted 用户自己的 Person

### 需求: 按人物的照片相册
系统应将照片与 Person 关联，每个 Person 最多 20 张照片。照片按人物查询和展示为相册。

#### 场景: 查看人物相册
- **当** 用户查看某 Person 的详情页
- **则** 系统返回该 Person 关联的最多 20 张照片，按创建时间倒序排列

#### 场景: 相册达到上限
- **当** 某 Person 已有 20 张关联照片，用户尝试再添加一张
- **则** 系统拒绝并提示已达 20 张上限

### 需求: 照片标记
系统应允许用户在合照中标记 Person，通过在照片上标记位置（x、y 为百分比 0-1）实现。

#### 场景: 在照片上添加人物标记
- **当** 用户点击照片上的某个位置并选择一个 Person
- **则** 系统创建一条 `photo_tags` 记录，包含照片 ID、Person ID、位置坐标和标记者 ID

#### 场景: 移除人物标记
- **当** 用户从照片中移除一个标记
- **则** 系统删除该 `photo_tags` 记录

### 需求: 删除照片
系统应允许照片上传者或 Owner 删除照片。删除时应移除照片文件、缩略图、所有关联标记，并扣减家庭存储计数。

#### 场景: 删除照片并回收存储
- **当** 用户删除自己上传的照片（或 Owner 删除任意照片）
- **则** 系统删除云存储文件、`photos` 记录、该照片的所有 `photo_tags`
- **且** 将家庭的 `storage_used_bytes` 扣减该文件大小

### 需求: 存储配额管理
系统应对每个家庭强制执行默认 500MB 存储限制。开发者可将 `storage_unlimited` 设为 true 以绕过限制。

#### 场景: 开发者解锁存储限制
- **当** 开发者将某家庭的 `storage_unlimited` 设为 true
- **则** 该家庭后续的所有上传配额检查均被绕过
