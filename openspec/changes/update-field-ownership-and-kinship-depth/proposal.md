# 变更: 重新设计字段数据归属模型 + 扩展至五代亲属称谓

## 为什么

当前设计中，Person 卡片上的手机号、城市等字段属于"共享数据"——一个人编辑后所有人看到的是同一份。但在真实使用场景中，家庭成员之间对同一个人的了解程度不同：我知道外婆的手机号，但我的堂妹未必知道；我给三舅备注的地址可能和妈妈记录的不一样。

现有设计试图用"隐私级别"（public/family_only/private）来解决这个问题，但它本质上解决的是"让不让别人看"，而不是"每个人记录的可能不一样"。手机号、微信号、地址等联系方式类信息天然适合"通讯录备注"模式——每个用户各存一份，互不影响。

此外，V1 版本的四代亲属称谓限制在实际使用中不够（高祖辈/玄孙辈无法覆盖），需要扩展到五代。

## 变更内容

### 1. 字段数据归属模型重新设计（**BREAKING**）

**核心思路：Person 卡片拆分为"共享层"和"私人覆盖层"**

- **共享字段**（存在 `persons` 集合，所有人看到同一份）：
  - 姓名、性别、出生年份、是否已故、头像、辈分
  - 这些是家庭成员的客观属性，不因观察者不同而不同

- **私人覆盖字段**（存在 `person_notes` 集合，每用户各一份）：
  - 手机号、微信号、城市/地址、职业、出生日期（完整）、自定义昵称、备注
  - 这些是每个用户自己记录的"对某人的了解"，属于用户自己的数据
  - 每个用户看到的是自己记录的版本

- **移除 `persons` 集合上的 `phone` 字段** — 不再有"共享手机号"概念
- **移除 `privacy_settings` 集合** — 不再需要字段级隐私控制（私人字段天然只有自己可见）
- **扩展 `person_notes` 集合** — 从 {custom_title, remark} 扩展为完整的私人覆盖层

### 2. 五代亲属称谓

- BFS 最大深度从 4 扩展到 5
- FORMAL_TITLE_MAP 从约 80 条扩展到约 150+ 条，覆盖高祖辈/玄孙辈
- 新增称谓示例：高祖父、高祖母、玄孙、玄孙女、族兄/族弟等

## 已确认的决策

| # | 决策 | 结论 |
|---|------|------|
| G | 私人字段范围 | 所有可编辑字段均为私人覆盖模式 |
| H | 共享手机号 | 移除，手机号完全改为私人备注 |
| I | UI 展示模式 | 仅保留私人模式，不再有共享/私人混合展示 |
| J | 亲属称谓深度 | 从四代扩展到五代 |

## 影响范围

- 涉及规格: person-management、privacy-control、kinship-titles
- 涉及数据模型:
  - `persons` 集合: 移除 phone 字段，移除 birth_date / city / occupation 字段
  - `person_notes` 集合: 大幅扩展，增加 phone / wechat_id / city / occupation / birth_date 等字段
  - `privacy_settings` 集合: **移除**（不再需要）
  - 集合总数从 12 减少到 11
- 涉及云函数: person/create、person/update、person/getDetail、person/updatePrivacy（移除）、note/upsert、note/get、relationship/computeTitle
- 涉及页面: person/detail、person/edit、person/privacy（移除或重新定位为"我的备注"）
- 涉及工具模块: titleMap.js（扩展至五代）
